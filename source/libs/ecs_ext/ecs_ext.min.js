window.es={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._inset={left:0,right:0,top:0,bottom:0},i._areMatrixedDirty=!0,i._areBoundsDirty=!0,i._isProjectionMatrixDirty=!0,i._zoom=0,i._minimumZoom=.3,i._maximumZoom=3,i._bounds=new t.Rectangle,i._transformMatrix=t.Matrix2D.identity,i._inverseTransformMatrix=t.Matrix2D.identity,i._origin=t.Vector2.zero,i.setZoom(0),i}return __extends(i,e),Object.defineProperty(i.prototype,"position",{get:function(){return this.entity.transform.position},set:function(t){this.entity.transform.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.entity.transform.rotation},set:function(t){this.entity.transform.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawZoom",{get:function(){return this._zoom},set:function(t){t!=this._zoom&&(this._zoom=t,this._areMatrixedDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zoom",{get:function(){return 0==this._zoom?1:this._zoom<1?t.MathHelper.map(this._zoom,this._minimumZoom,1,-1,0):t.MathHelper.map(this._zoom,1,this._maximumZoom,0,1)},set:function(t){this.setZoom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minimumZoom",{get:function(){return this._minimumZoom},set:function(t){this.setMinimumZoom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maximumZoom",{get:function(){return this._maximumZoom},set:function(t){this.setMaximumZoom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){if(this._areMatrixedDirty&&this.updateMatrixes(),this._areBoundsDirty){var e=this.screenToWorldPoint(new t.Vector2(this._inset.left,this._inset.top)),i=this.screenToWorldPoint(new t.Vector2(t.Core.Instance.width-this._inset.right,t.Core.Instance.height-this._inset.bottom));if(0!=this.entity.transform.rotation){var o=this.screenToWorldPoint(new t.Vector2(t.Core.Instance.width-this._inset.right,this._inset.top)),n=this.screenToWorldPoint(new t.Vector2(this._inset.left,t.Core.Instance.height-this._inset.bottom)),r=Math.min(e.x,i.x,o.x,n.x),s=Math.max(e.x,i.x,o.x,n.x),a=Math.min(e.y,i.y,o.y,n.y),h=Math.max(e.y,i.y,o.y,n.y);this._bounds.location=new t.Vector2(r,a),this._bounds.width=s-r,this._bounds.height=h-a}else this._bounds.location=e,this._bounds.width=i.x-e.x,this._bounds.height=i.y-e.y;this._areBoundsDirty=!1}return this._bounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transformMatrix",{get:function(){return this._areMatrixedDirty&&this.updateMatrixes(),this._transformMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inverseTransformMatrix",{get:function(){return this._areMatrixedDirty&&this.updateMatrixes(),this._inverseTransformMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"origin",{get:function(){return this._origin},set:function(t){this._origin!=t&&(this._origin=t,this._areMatrixedDirty=!0)},enumerable:!0,configurable:!0}),i.prototype.setInset=function(t,e,i,o){return this._inset={left:t,right:e,top:i,bottom:o},this._areBoundsDirty=!0,this},i.prototype.setPosition=function(t){return this.entity.transform.setPosition(t.x,t.y),this},i.prototype.setRotation=function(t){return this.entity.transform.setRotation(t),this},i.prototype.setZoom=function(e){var i=t.MathHelper.clamp(e,-1,1);return this._zoom=0==i?1:i<0?t.MathHelper.map(i,-1,0,this._minimumZoom,1):t.MathHelper.map(i,0,1,1,this._maximumZoom),this._areMatrixedDirty=!0,this},i.prototype.setMinimumZoom=function(t){if(!(t<=0))return this._zoom<t&&(this._zoom=this.minimumZoom),this._minimumZoom=t,this;console.error("minimumZoom must be greater than zero")},i.prototype.setMaximumZoom=function(t){if(!(t<=0))return this._zoom>t&&(this._zoom=t),this._maximumZoom=t,this;console.error("maximumZoom must be greater than zero")},i.prototype.forceMatrixUpdate=function(){this._areMatrixedDirty=!0},i.prototype.onEntityTransformChanged=function(t){this._areMatrixedDirty=!0},i.prototype.zoomIn=function(t){this.zoom+=t},i.prototype.zoomOut=function(t){this.zoom-=t},i.prototype.worldToScreenPoint=function(e){return this.updateMatrixes(),t.Vector2Ext.transformR(e,this._transformMatrix,e),e},i.prototype.screenToWorldPoint=function(e){return this.updateMatrixes(),t.Vector2Ext.transformR(e,this._inverseTransformMatrix,e),e},i.prototype.onSceneRenderTargetSizeChanged=function(e,i){this._isProjectionMatrixDirty=!0;var o=this._origin;this.origin=new t.Vector2(e/2,i/2),this.entity.transform.position.add(t.Vector2.subtract(this._origin,o))},i.prototype.updateMatrixes=function(){var e;this._areMatrixedDirty&&(this._transformMatrix=t.Matrix2D.createTranslation(-this.entity.transform.position.x,-this.entity.transform.position.y),1!=this._zoom&&(e=t.Matrix2D.createScale(this._zoom,this._zoom),this._transformMatrix=this._transformMatrix.multiply(e)),0!=this.entity.transform.rotation&&(e=t.Matrix2D.createRotation(this.entity.transform.rotation),this._transformMatrix=this._transformMatrix.multiply(e)),e=t.Matrix2D.createTranslation(Math.floor(this._origin.x),Math.floor(this._origin.y)),this._transformMatrix=this._transformMatrix.multiply(e),this._inverseTransformMatrix=t.Matrix2D.invert(this._transformMatrix),this._areBoundsDirty=!0,this._areMatrixedDirty=!1)},i}(t.Component);t.Camera=e}(es||(es={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._shakeDirection=t.Vector2.zero,i._shakeOffset=t.Vector2.zero,i._shakeIntensity=0,i._shakeDegredation=.95,i}return __extends(i,e),i.prototype.shake=function(e,i,o){void 0===e&&(e=15),void 0===i&&(i=.9),void 0===o&&(o=t.Vector2.zero),this.enabled=!0,this._shakeIntensity<e&&(this._shakeDirection=o,this._shakeIntensity=e,(i<0||i>=1)&&(i=.95),this._shakeDegredation=i)},i.prototype.update=function(){Math.abs(this._shakeIntensity)>0&&(this._shakeOffset=this._shakeDirection,0!=this._shakeOffset.x||0!=this._shakeOffset.y?this._shakeOffset.normalize():(this._shakeOffset.x=this._shakeOffset.x+Math.random()-.5,this._shakeOffset.y=this._shakeOffset.y+Math.random()-.5),this._shakeOffset.multiply(new t.Vector2(this._shakeIntensity)),this._shakeIntensity*=-this._shakeDegredation,Math.abs(this._shakeIntensity)<=.01&&(this._shakeIntensity=0,this.enabled=!1))},i}(t.Component);t.CameraShake=e}(es||(es={})),function(t){var e;!function(t){t[t.lockOn=0]="lockOn",t[t.cameraWindow=1]="cameraWindow"}(e=t.CameraStyle||(t.CameraStyle={}));var i=function(i){function o(o,n,r){void 0===o&&(o=null),void 0===n&&(n=null),void 0===r&&(r=e.lockOn);var s=i.call(this)||this;return s.followLerp=.1,s.deadzone=new t.Rectangle,s.focusOffset=t.Vector2.zero,s.mapLockEnabled=!1,s.mapSize=new t.Rectangle,s._desiredPositionDelta=new t.Vector2,s._worldSpaceDeadZone=new t.Rectangle,s._targetEntity=o,s._cameraStyle=r,s.camera=n,s}return __extends(o,i),o.prototype.onAddedToEntity=function(){null==this.camera&&(this.camera=this.entity.getOrCreateComponent(t.Camera)),this.follow(this._targetEntity,this._cameraStyle),t.Core.emitter.addObserver(t.CoreEvents.GraphicsDeviceReset,this.onGraphicsDeviceReset,this)},o.prototype.onGraphicsDeviceReset=function(){t.Core.schedule(0,!1,this,function(t){var e=t.context;e.follow(e._targetEntity,e._cameraStyle)})},o.prototype.update=function(){var e=t.Vector2.multiply(this.camera.bounds.size,new t.Vector2(.5));this._worldSpaceDeadZone.x=this.camera.position.x-e.x+this.deadzone.x+this.focusOffset.x,this._worldSpaceDeadZone.y=this.camera.position.y-e.y+this.deadzone.y+this.focusOffset.y,this._worldSpaceDeadZone.width=this.deadzone.width,this._worldSpaceDeadZone.height=this.deadzone.height,this._targetEntity&&this.updateFollow(),this.camera.position=t.Vector2.lerp(this.camera.position,t.Vector2.add(this.camera.position,this._desiredPositionDelta),this.followLerp),this.entity.transform.roundPosition(),this.mapLockEnabled&&(this.camera.position=this.clampToMapSize(this.camera.position),this.entity.transform.roundPosition())},o.prototype.clampToMapSize=function(e){var i=t.Vector2.multiply(this.camera.bounds.size,new t.Vector2(.5)).add(new t.Vector2(this.mapSize.x,this.mapSize.y)),o=new t.Vector2(this.mapSize.width-i.x,this.mapSize.height-i.y);return t.Vector2.clamp(e,i,o)},o.prototype.follow=function(i,o){void 0===o&&(o=e.cameraWindow),this._targetEntity=i,this._cameraStyle=o;var n=this.camera.bounds;switch(this._cameraStyle){case e.cameraWindow:var r=n.width/6,s=n.height/3;this.deadzone=new t.Rectangle((n.width-r)/2,(n.height-s)/2,r,s);break;case e.lockOn:this.deadzone=new t.Rectangle(n.width/2,n.height/2,10,10)}},o.prototype.updateFollow=function(){if(this._desiredPositionDelta.x=this._desiredPositionDelta.y=0,this._cameraStyle==e.lockOn){var i=this._targetEntity.transform.position.x,o=this._targetEntity.transform.position.y;this._worldSpaceDeadZone.x>i?this._desiredPositionDelta.x=i-this._worldSpaceDeadZone.x:this._worldSpaceDeadZone.x<i&&(this._desiredPositionDelta.x=i-this._worldSpaceDeadZone.x),this._worldSpaceDeadZone.y<o?this._desiredPositionDelta.y=o-this._worldSpaceDeadZone.y:this._worldSpaceDeadZone.y>o&&(this._desiredPositionDelta.y=o-this._worldSpaceDeadZone.y)}else{if(!this._targetCollider&&(this._targetCollider=this._targetEntity.getComponent(t.Collider),!this._targetCollider))return;var n=this._targetEntity.getComponent(t.Collider).bounds;this._worldSpaceDeadZone.containsRect(n)||(this._worldSpaceDeadZone.left>n.left?this._desiredPositionDelta.x=n.left-this._worldSpaceDeadZone.left:this._worldSpaceDeadZone.right<n.right&&(this._desiredPositionDelta.x=n.right-this._worldSpaceDeadZone.right),this._worldSpaceDeadZone.bottom<n.bottom?this._desiredPositionDelta.y=n.bottom-this._worldSpaceDeadZone.bottom:this._worldSpaceDeadZone.top>n.top&&(this._desiredPositionDelta.y=n.top-this._worldSpaceDeadZone.top))}},o.prototype.setCenteredDeadzone=function(e,i){if(this.camera){var o=this.camera.bounds;this.deadzone=new t.Rectangle((o.width-e)/2,(o.height-i)/2,e,i)}else console.error("相机是null。我们不能得到它的边界。请等到该组件添加到实体之后")},o}(t.Component);t.FollowCamera=i}(es||(es={})),function(t){var e=function(){function e(e,i,o){void 0===i&&(i=new t.Rectangle(0,0,e.textureWidth,e.textureHeight)),void 0===o&&(o=i.getHalfSize()),this.uvs=new t.Rectangle,this.texture2D=e,this.sourceRect=i,this.center=new t.Vector2(.5*i.width,.5*i.height),this.origin=o;var n=1/e.textureWidth,r=1/e.textureHeight;this.uvs.x=i.x*n,this.uvs.y=i.y*r,this.uvs.width=i.width*n,this.uvs.height=i.height*r}return e.spritesFromAtlas=function(t,i,o,n,r){void 0===n&&(n=0),void 0===r&&(r=Number.MAX_VALUE);for(var s=[],a=t.textureWidth/i,h=t.textureHeight/o,c=0,p=new egret.SpriteSheet(t),m=0;m<h;m++)for(var u=0;u<a;u++)if(!(c++<n)){var d=p.getTexture(m+"_"+u);if(d||(d=p.createTexture(m+"_"+u,u*i,m*o,i,o)),s.push(new e(d)),s.length==r)return s}return s},e}();t.Sprite=e}(es||(es={})),function(t){var e=function(){return function(t,e){void 0===e&&(e=10),this.sprites=t,this.frameRate=e}}();t.SpriteAnimation=e}(es||(es={})),function(t){var e=function(e){function i(i){void 0===i&&(i=null);var o=e.call(this)||this;return i instanceof t.Sprite?o.setSprite(i):i instanceof egret.Texture&&o.setSprite(new t.Sprite(i)),o}return __extends(i,e),Object.defineProperty(i.prototype,"origin",{get:function(){return this._origin},set:function(t){this.setOrigin(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sprite",{get:function(){return this._sprite},set:function(t){this.setSprite(t)},enumerable:!0,configurable:!0}),i.prototype.setSprite=function(t){return this._sprite=t,this._sprite&&(this._origin=this._sprite.origin),this},i.prototype.setOrigin=function(t){return this._origin.equals(t)||(this._origin=t),this},i}(t.Component);t.SpriteRenderer=e}(es||(es={})),function(t){var e,i;!function(t){t[t.loop=0]="loop",t[t.once=1]="once",t[t.clampForever=2]="clampForever",t[t.pingPong=3]="pingPong",t[t.pingPongOnce=4]="pingPongOnce"}(e=t.LoopMode||(t.LoopMode={})),function(t){t[t.none=0]="none",t[t.running=1]="running",t[t.paused=2]="paused",t[t.completed=3]="completed"}(i=t.State||(t.State={}));var o=function(o){function n(t){var e=o.call(this,t)||this;return e.speed=1,e.animationState=i.none,e._elapsedTime=0,e._animations=new Map,e}return __extends(n,o),Object.defineProperty(n.prototype,"isRunning",{get:function(){return this.animationState==i.running},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),n.prototype.update=function(){if(this.animationState==i.running&&null!=this.currentAnimation){var o=this.currentAnimation,n=1/(o.frameRate*this.speed),r=n*o.sprites.length,s=o.sprites.length<3?r:n*(2*o.sprites.length-2);this._elapsedTime+=t.Time.deltaTime;var a=Math.abs(this._elapsedTime);if(this._loopMode==e.once&&a>r||this._loopMode==e.pingPongOnce&&a>s)return this.animationState=i.completed,this._elapsedTime=0,this.currentFrame=0,this.sprite=o.sprites[0],void this.onAnimationCompletedEvent(this.currentAnimationName);if(this._loopMode==e.clampForever&&a>r)return this.animationState=i.completed,this.currentFrame=o.sprites.length-1,this.sprite=o.sprites[this.currentFrame],void this.onAnimationCompletedEvent(this.currentAnimationName);var h=Math.floor(a/n),c=o.sprites.length;if(c>2&&(this._loopMode==e.pingPong||this._loopMode==e.pingPongOnce)){var p=c-1;this.currentFrame=p-Math.abs(p-h%(2*p))}else this.currentFrame=h%c;this.sprite=o.sprites[this.currentFrame]}},n.prototype.addAnimation=function(t,e){return!this.sprite&&e.sprites.length>0&&this.setSprite(e.sprites[0]),this._animations[t]=e,this},n.prototype.play=function(t,o){void 0===o&&(o=null),this.currentAnimation=this._animations[t],this.currentAnimationName=t,this.currentFrame=0,this.animationState=i.running,this.sprite=this.currentAnimation.sprites[0],this._elapsedTime=0,this._loopMode=o||e.loop},n.prototype.isAnimationActive=function(t){return null!=this.currentAnimation&&this.currentAnimationName==t},n.prototype.pause=function(){this.animationState=i.paused},n.prototype.unPause=function(){this.animationState=i.running},n.prototype.stop=function(){this.currentAnimation=null,this.currentAnimationName=null,this.currentFrame=0,this.animationState=i.none},n}(t.SpriteRenderer);t.SpriteAnimator=o}(es||(es={}));